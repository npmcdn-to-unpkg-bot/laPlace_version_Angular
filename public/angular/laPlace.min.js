(function(){angular.module("laPlaceApp",["ngRoute","ngSanitize","ui.bootstrap","toastr"]);function e(e,t,o){e.when("/",{templateUrl:"accueil/accueil.view.html",controller:"accueilCtrl",controllerAs:"vm"}).when("/a-propos",{templateUrl:"/commun/vues/a-propos.vue.html",controller:"aProposCtrl",controllerAs:"vm"}).when("/endroits/:endroitid",{templateUrl:"commun/vues/endroitDetail/endroitDetails.vue.html",controller:"endroitDetailsCtrl",controllerAs:"vm"}).when("/endroits/editer/:endroitid",{templateUrl:"commun/endroitEdit/endroitEdit.vue.html",controller:"endroitEditCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"});t.html5Mode(true);angular.extend(o,{allowHtml:false,closeButton:false,closeHtml:"<button>&times;</button>",extendedTimeOut:1e3,maxOpened:0,iconClasses:{error:"toast-error",info:"toast-info",success:"toast-success",warning:"toast-warning"},messageClass:"toast-message",onHidden:null,onShown:null,onTap:null,progressBar:true,tapToDismiss:true,templates:{toast:"directives/toast/toast.html",progressbar:"directives/progressbar/progressbar.html"},timeOut:5e3,titleClass:"toast-title",toastClass:"toast"})}angular.module("laPlaceApp").config(["$routeProvider","$locationProvider","toastrConfig",e])})();(function(){angular.module("laPlaceApp").controller("accueilCtrl",e);e.$inject=["$scope","laPlaceData","geolocalisation"];function e(e,t,o){var r=this;r.headerDeLaPage={titre:"laPlace ",tagline:"permet de trouver un etablissement pres de chez vous"};r.sidebar={contenu:"Cherchez un endroit ? laPlace est là pour vous."};r.message="Verification en cours de votre localisation";r.getData=function(e){var o=e.coords.latitude,n=e.coords.longitude;r.message="Recherche d'endroits proche en cours";t.locationByCoords(o,n).success(function(e){r.message=e.length>0?"":"Aucuns endroits trouvé pres de votre positiob";r.data={endroits:e}}).error(function(e){r.message="Desole, quelque chose s'est mal passé."})};r.showError=function(t){e.$apply(function(){r.message=t.message})};r.noGeo=function(){e.$apply(function(){r.message="La geolocalisation n'est pas supportée par votre navigateur."})};o.getPosition(r.getData,r.showError,r.noGeo)}})();(function(){angular.module("laPlaceApp").controller("aProposCtrl",e);e.$inject=["$scope"];function e(e){var t=this;e.toto="tootoo";t.headerDeLaPage={titre:"a PROPOS laPlace"};t.principal={contenu:"laPlace BlaBlA BLA.\n\nLorem ipsum dolor sit amet, consectetur adipiscing elit."}}})();(function(){angular.module("laPlaceApp").service("geolocalisation",e);function e(){var e=function(e,t,o){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(e,t)}else{o()}};return{getPosition:e}}})();(function(){angular.module("laPlaceApp").service("laPlaceData",e);e.$inject=["$http"];function e(e){var t=function(t,o){return e.get("/api/endroits?lng="+o+"&lat="+t+"&maxDistance=20000000")};var o=function(t){return e.get("/api/endroits/"+t)};var r=function(t,o){return e.post("/api/endroits/"+t+"/commentaires",o)};return{locationByCoords:t,endroitParid:o,ajoutCommentaireParID:r}}})();(function(){var e=function(e){return!isNaN(parseFloat(e))&&isFinite(e)};var t=function(){return function(t){var o,r;if(t&&e(t)){if(t>1){o=parseFloat(t).toFixed(1);r="km"}else{o=parseInt(t*1e3,10);r="m"}return o+r}else{return"?"}}};angular.module("laPlaceApp").filter("distanceFormatee",t)})();(function(){angular.module("laPlaceApp").filter("ajoutBr",e);function e(){return function(e){var t=e.replace(/\n/g,"<br/>");return t}}})();(function(){angular.module("laPlaceApp").directive("noteEtoilees",e);function e(){return{restrict:"EA",scope:{laNote:"=note"},templateUrl:"/commun/directives/noteEtoilees/note-etoilees.template.html"}}})();(function(){angular.module("laPlaceApp").directive("footerGenerique",e);function e(){return{restrict:"EA",templateUrl:"/commun/directives/footerGenerique/footerGenerique.template.html"}}})();(function(){angular.module("laPlaceApp").directive("navigation",e);function e(){return{restrict:"EA",templateUrl:"/commun/directives/navigation/navigation.template.html"}}})();(function(){angular.module("laPlaceApp").controller("endroitDetailsCtrl",e);e.$inject=["$routeParams","$uibModal","laPlaceData"];function e(e,t,o){var r=this;r.endroitid=e.endroitid;o.endroitParid(r.endroitid).success(function(e){r.data={endroit:e};r.headerDeLaPage={titre:r.data.endroit.nom}}).error(function(e){console.log(e)});r.popUpAjoutCommentaire=function(){var e=t.open({templateUrl:"commun/vues/commentaireModal/commentaireModal.vue.html",controller:"commentaireModalCtrl as vm",resolve:{endroitData:function(){return{endroitid:r.endroitid,endroitNom:r.data.endroit.nom}}}});e.result.then(function(e){r.data.endroit.commentaires.push(e)})}}})();(function(){angular.module("laPlaceApp").controller("commentaireModalCtrl",e);e.$inject=["$uibModalInstance","endroitData","laPlaceData","toastr"];function e(e,t,o,r){var n=this;n.endroitData=t;n.envoyerFormulaire=function(){n.formErreur="";if(!n.formData.nom||!n.formData.note||!n.formData.texte){n.formErreur="Tous les champs sont requis.";return false}else{n.ajoutCommentaireParID(n.endroitData.endroitid,n.formData)}};n.ajoutCommentaireParID=function(e,t){o.ajoutCommentaireParID(e,{auteur:t.nom,note:t.note,texte:t.texte}).success(function(e){console.log("Message envoyé avec succes!");n.modal.close(e)}).error(function(e){n.formError="Commentaire non sauvé. erreur";r.error("Commentaire non sauvé. erreur","Error")});return false};n.modal={close:function(t){e.close(t)},annuler:function(){e.dismiss()}}}})();(function(){angular.module("laPlaceApp").controller("endroitEditCtrl",e);e.$inject=["$routeParams","laPlaceData","$http","toastr"];function e(e,t,o,r){var n=this;n.endroitid=e.endroitid;t.endroitParid(n.endroitid).success(function(e){n.data={endroit:e};n.headerDeLaPage={titre:n.data.endroit.nom}}).error(function(e){console.log(e)});n.modifier=function(){var t={nom:n.data.endroit.nom,adresse:n.data.endroit.adresse,services:n.data.endroit.services.toString(),coords:[parseFloat(n.data.endroit.coords[0]),parseFloat(n.data.endroit.coords[1])],heuresOuverture:[{jours:n.data.endroit.heuresOuverture[0].jours,ouverture:n.data.endroit.heuresOuverture[0].ouverture,fermeture:n.data.endroit.heuresOuverture[0].fermeture,ferme:n.data.endroit.heuresOuverture[0].ferme},{jours:n.data.endroit.heuresOuverture[1].jours,ouverture:n.data.endroit.heuresOuverture[1].ouverture,fermeture:n.data.endroit.heuresOuverture[1].fermeture,ferme:n.data.endroit.heuresOuverture[1].ferme}]};console.log("****************************************");o.put("api/endroits/"+e.endroitid,t).success(function(e,t,o){console.log("successsuccesssuccesssuccesssuccesssuccessvv");r.success("Edition effectuée avec succes","Edition");console.log(e);n.headerDeLaPage={titre:n.data.endroit.nom}}).error(function(e,t,o,n){console.log("erererere");r.error("Your credentials are gone","Error")})}}})();(function(){angular.module("laPlaceApp").service("authentificationService",e);e.$inject=["$window"];function e(e){var t=function(t){e.localStorage["tokenPourLeSiteLaPlace"]=t};var o=function(){return e.localStorage["tokenPourLeSiteLaPlace"]};enregistrement=function(e){return $http.post("/api/enregistrement",e).success(function(e){t(e.token)})};login=function(e){return $http.post("/api/login",e).success(function(e){t(e.token)})};logout=function(){e.localStorage.removeItem("tokenPourLeSiteLaPlace")};var r=function(){var t=o();if(t){var r=JSON.parse(e.atob(t.split(".")[1]));return r.exp>Date.now()/1e3}else{return false}};var n=function(){if(r()){var t=o();var n=JSON.parse(e.atob(t.split(".")[1]));return{email:n.email,nom:n.nom}}};return{saveToken:t,getToken:o,enregistrement:enregistrement,login:login,utilisateurEnCours:n,estLoggeDansLapp:r,logout:logout}}})();