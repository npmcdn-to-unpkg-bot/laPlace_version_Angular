(function(){angular.module("laPlaceApp",["ngRoute","ngSanitize","ui.bootstrap","toastr"]);function e(e,t,r){e.when("/",{templateUrl:"accueil/accueil.view.html",controller:"accueilCtrl",controllerAs:"vm"}).when("/a-propos",{templateUrl:"/commun/vues/a-propos.vue.html",controller:"aProposCtrl",controllerAs:"vm"}).when("/enregistrement",{templateUrl:"commun/authentification/enregistrement/enregistrement.view.html",controller:"enregistrementCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"commun/authentification/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).when("/endroits/:endroitid",{templateUrl:"commun/vues/endroitDetail/endroitDetails.vue.html",controller:"endroitDetailsCtrl",controllerAs:"vm"}).when("/endroits/ajouter/ajout",{templateUrl:"commun/endroitAjouter/endroitAjouter.vue.html",controller:"endroitAjouterCtrl",controllerAs:"vm",secure:true}).when("/endroits/editer/:endroitid",{templateUrl:"commun/endroitEdit/endroitEdit.vue.html",controller:"endroitEditCtrl",controllerAs:"vm",secure:true}).otherwise({redirectTo:"/"});t.html5Mode(true);angular.extend(r,{allowHtml:false,closeButton:false,closeHtml:"<button>&times;</button>",extendedTimeOut:1e3,maxOpened:0,iconClasses:{error:"toast-error",info:"toast-info",success:"toast-success",warning:"toast-warning"},messageClass:"toast-message",onHidden:null,onShown:null,onTap:null,progressBar:true,tapToDismiss:true,templates:{toast:"directives/toast/toast.html",progressbar:"directives/progressbar/progressbar.html"},timeOut:5e3,titleClass:"toast-title",toastClass:"toast"})}angular.module("laPlaceApp").config(["$routeProvider","$locationProvider","toastrConfig",e]).run(["$rootScope","$location","authentificationService",function(e,t,r){e.$on("$routeChangeStart",function(o,n,a){if(n&&n.$$route&&n.$$route.secure){if(r.estLoggeDansLapp()&&r.utilisateurEnCours().admin===true){console.log("Bienvenue Admin, loggin effectué avec SUCCESS !")}else{e.$evalAsync(function(){t.path("/login")});console.log("C'est pas l'admin....")}}})}])})();(function(){angular.module("laPlaceApp").controller("accueilCtrl",e);e.$inject=["$scope","laPlaceData","geolocalisation","authentificationService"];function e(e,t,r,o){var n=this;n.encours=o.utilisateurEnCours();n.headerDeLaPage={titre:"laPlace ",tagline:"permet de trouver un etablissement pres de chez vous"};n.sidebar={contenu:"Cherchez un endroit ? laPlace est là pour vous."};n.message="Verification en cours de votre localisation";n.getData=function(e){var r=e.coords.latitude,o=e.coords.longitude;n.message="Recherche d'endroits proche en cours";t.locationByCoords(r,o).success(function(e){n.message=e.length>0?"":"Aucuns endroits trouvé pres de votre positiob";n.data={endroits:e}}).error(function(e){n.message="Desole, quelque chose s'est mal passé."})};n.showError=function(t){e.$apply(function(){n.message=t.message})};n.noGeo=function(){e.$apply(function(){n.message="La geolocalisation n'est pas supportée par votre navigateur."})};r.getPosition(n.getData,n.showError,n.noGeo)}})();(function(){angular.module("laPlaceApp").controller("aProposCtrl",e);e.$inject=["$scope"];function e(e){var t=this;e.toto="tootoo";t.headerDeLaPage={titre:"a PROPOS laPlace"};t.principal={contenu:"laPlace BlaBlA BLA.\n\nLorem ipsum dolor sit amet, consectetur adipiscing elit."}}})();(function(){angular.module("laPlaceApp").service("geolocalisation",e);function e(){var e=function(e,t,r){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(e,t)}else{r()}};return{getPosition:e}}})();(function(){angular.module("laPlaceApp").service("laPlaceData",e);e.$inject=["$http","authentificationService"];function e(e,t){var r=function(t,r){return e.get("/api/endroits?lng="+r+"&lat="+t+"&maxDistance=20000000")};var o=function(t){return e.get("/api/endroits/"+t)};var n=function(r,o){return e.post("/api/endroits/"+r+"/commentaires",o,{headers:{Authorization:"Bearer "+t.getToken()}})};return{locationByCoords:r,endroitParid:o,ajoutCommentaireParID:n}}})();(function(){var e=function(e){return!isNaN(parseFloat(e))&&isFinite(e)};var t=function(){return function(t){var r,o;if(t&&e(t)){if(t>1){r=parseFloat(t).toFixed(1);o="km"}else{r=parseInt(t*1e3,10);o="m"}return r+o}else{return"?"}}};angular.module("laPlaceApp").filter("distanceFormatee",t)})();(function(){angular.module("laPlaceApp").filter("ajoutBr",e);function e(){return function(e){var t=e.replace(/\n/g,"<br/>");return t}}})();(function(){angular.module("laPlaceApp").directive("noteEtoilees",e);function e(){return{restrict:"EA",scope:{laNote:"=note"},templateUrl:"/commun/directives/noteEtoilees/note-etoilees.template.html"}}})();(function(){angular.module("laPlaceApp").directive("footerGenerique",e);function e(){return{restrict:"EA",templateUrl:"/commun/directives/footerGenerique/footerGenerique.template.html"}}})();(function(){angular.module("laPlaceApp").directive("navigation",e);function e(){return{restrict:"EA",templateUrl:"/commun/directives/navigation/navigation.template.html",controller:"navigationCtrl as navvm"}}})();(function(){angular.module("laPlaceApp").controller("endroitDetailsCtrl",e);e.$inject=["$http","$routeParams","$location","$uibModal","laPlaceData","authentificationService","toastr"];function e(e,t,r,o,n,a,i){var s=this;s.endroitid=t.endroitid;s.estLoggeDansLapp=a.estLoggeDansLapp();s.lePathCourrant=r.path();s.encours=a.utilisateurEnCours();s.supprLeCom=function(r){if(window.confirm("Etes-vous sur?")){console.log("id de endroit: "+t.endroitid);console.log("id du commentaire: "+r);e.delete("/api/endroits/"+t.endroitid+"/commentaires/"+r,{headers:{Authorization:"Bearer "+a.getToken()}}).then(function(e){i.success("Suppression effectuée avec succes","Suppression");n.endroitParid(s.endroitid).success(function(e){s.data={endroit:e};s.data.endroit.commentaires=s.data.endroit.commentaires}).error(function(e){console.log(e)})},function(e){console.log(e);i.error(e.data.message,"Erreur")})}};n.endroitParid(s.endroitid).success(function(e){s.data={endroit:e};s.headerDeLaPage={titre:s.data.endroit.nom}}).error(function(e){console.log(e)});s.popUpAjoutCommentaire=function(){var e=o.open({templateUrl:"commun/vues/commentaireModal/commentaireModal.vue.html",controller:"commentaireModalCtrl as vm",resolve:{endroitData:function(){return{endroitid:s.endroitid,endroitNom:s.data.endroit.nom}}}});e.result.then(function(e){s.data.endroit.commentaires.push(e)})}}})();(function(){angular.module("laPlaceApp").controller("commentaireModalCtrl",e);e.$inject=["$uibModalInstance","endroitData","laPlaceData","toastr"];function e(e,t,r,o){var n=this;n.endroitData=t;n.envoyerFormulaire=function(){n.formErreur="";console.log("arret ici");if(!n.formData||!n.formData.note||!n.formData.texte){n.formErreur="Tous les champs sont requis.";return false}else{n.ajoutCommentaireParID(n.endroitData.endroitid,n.formData)}};n.ajoutCommentaireParID=function(e,t){r.ajoutCommentaireParID(e,{note:t.note,texte:t.texte}).success(function(e){console.log("Message envoyé avec succes!");o.success("Message envoyé avec succes!","Succes");n.modal.close(e)}).error(function(e){n.formError="Commentaire non sauvé. erreur";o.error("Commentaire non sauvé. erreur","Error")});return false};n.modal={close:function(t){e.close(t)},annuler:function(){e.dismiss()}}}})();(function(){angular.module("laPlaceApp").controller("endroitEditCtrl",e);e.$inject=["$routeParams","$location","laPlaceData","$http","toastr","authentificationService"];function e(e,t,r,o,n,a){var i=this;i.endroitid=e.endroitid;r.endroitParid(i.endroitid).success(function(e){i.data={endroit:e};i.headerDeLaPage={titre:i.data.endroit.nom}}).error(function(e){console.log(e)});i.modifier=function(){var r={nom:i.data.endroit.nom,adresse:i.data.endroit.adresse,services:i.data.endroit.services.toString(),coords:[parseFloat(i.data.endroit.coords[0]),parseFloat(i.data.endroit.coords[1])],heuresOuverture:[{jours:i.data.endroit.heuresOuverture[0].jours,ouverture:i.data.endroit.heuresOuverture[0].ouverture,fermeture:i.data.endroit.heuresOuverture[0].fermeture,ferme:i.data.endroit.heuresOuverture[0].ferme},{jours:i.data.endroit.heuresOuverture[1].jours,ouverture:i.data.endroit.heuresOuverture[1].ouverture,fermeture:i.data.endroit.heuresOuverture[1].fermeture,ferme:i.data.endroit.heuresOuverture[1].ferme}]};console.log("****************************************");o.put("api/endroits/"+e.endroitid,r,{headers:{Authorization:"Bearer "+a.getToken()}}).success(function(e,r,o){console.log("successsuccesssuccesssuccesssuccesssuccessvv");n.success("Edition effectuée avec succes","Edition");console.log(e);i.headerDeLaPage={titre:i.data.endroit.nom};t.path("/endroits/"+e._id)}).error(function(e,t,r,o){console.log("erererere");n.error("Your credentials are gone","Error")})};i.supprimerEndroit=function(){if(window.confirm("Etes-vous sur?")){console.log("id de endroit: "+e.endroitid);o.delete("/api/endroits/"+e.endroitid,{headers:{Authorization:"Bearer "+a.getToken()}}).then(function(e){n.success("Suppression effectuée avec succes","Suppression");t.path("/")},function(e){console.log(e);n.error(e.data.message,"Erreur")})}}}})();(function(){angular.module("laPlaceApp").service("authentificationService",e);e.$inject=["$http","$window"];function e(e,t){var r=function(e){t.localStorage["tokenPourLeSiteLaPlace"]=e};var o=function(){return t.localStorage["tokenPourLeSiteLaPlace"]};enregistrement=function(t){return e.post("/api/enregistrement",t).success(function(e){r(e.token)})};login=function(t){return e.post("/api/login",t).success(function(e){r(e.token)})};logout=function(){t.localStorage.removeItem("tokenPourLeSiteLaPlace")};var n=function(){var e=o();if(e){var r=JSON.parse(t.atob(e.split(".")[1]));return r.exp>Date.now()/1e3}else{return false}};var a=function(){var e=o();if(e){return true}else{return false}};var i=function(){if(n()){var e=o();var r=JSON.parse(t.atob(e.split(".")[1]));return{email:r.email,nom:r.nom,admin:r.admin}}};return{saveToken:r,getToken:o,enregistrement:enregistrement,login:login,utilisateurEnCours:i,estLoggeDansLapp:n,logout:logout,ddd:a}}})();(function(){angular.module("laPlaceApp").controller("enregistrementCtrl",e);e.$inject=["$location","authentificationService"];function e(e,t){var r=this;r.headerDeLaPage={titre:"Creer votre compte"};r.informations={nom:"",email:"",password:""};r.retourAlaPagePrecedente=e.search().page||"/";r.envoyerLeFormulaireEnregistrement=function(){r.erreursDansLeFormulaire="";if(!r.informations.nom||!r.informations.email||!r.informations.password){r.erreursDansLeFormulaire="Tous les champs sont requis, veuillez essayer de nouveau.";return false}else{r.enregistrementEffectif()}};r.enregistrementEffectif=function(){r.erreursDansLeFormulaire="";t.enregistrement(r.informations).error(function(e){r.erreursDansLeFormulaire=e}).then(function(){e.search("page",null);e.path(r.retourAlaPagePrecedente)})}}})();angular.module("laPlaceApp").controller("loginCtrl",loginCtrl);loginCtrl.$inject=["$location","authentificationService"];function loginCtrl(e,t){var r=this;r.headerDeLaPage={titre:"Connexion à laPLace"};r.informations={email:"",password:""};r.retourAlaPagePrecedente=e.search().page||"/";r.envoyerLeFormulaireEnregistrement=function(){r.erreursDansLeFormulaire="";if(!r.informations.email||!r.informations.password){r.erreursDansLeFormulaire="Tous les champs sont requis, veuillez essayer de nouveau.";return false}else{r.loginEffectif()}};r.loginEffectif=function(){r.erreursDansLeFormulaire="";t.login(r.informations).error(function(e){r.erreursDansLeFormulaire=e}).then(function(){e.search("page",null);e.path(r.retourAlaPagePrecedente)})}}(function(){angular.module("laPlaceApp").controller("navigationCtrl",e);e.$inject=["$location","authentificationService"];function e(e,t){var r=this;r.lePathCourrant=e.path();r.estLoggeDansLapp=t.estLoggeDansLapp();r.utilisateurEnCours=t.utilisateurEnCours();r.logout=function(){t.logout();r.estLoggeDansLapp="";e.path("/")}}})();(function(){angular.module("laPlaceApp").controller("endroitAjouterCtrl",e);e.$inject=["$routeParams","$location","laPlaceData","$http","toastr","authentificationService"];function e(e,t,r,o,n,a){var i=this;i.ajouter=function(){var e={nom:i.data.endroit.nom,adresse:i.data.endroit.adresse,services:i.data.endroit.services.toString(),coords:[parseFloat(i.data.endroit.coords[0]),parseFloat(i.data.endroit.coords[1])],heuresOuverture:[{jours:i.data.endroit.heuresOuverture[0].jours,ouverture:i.data.endroit.heuresOuverture[0].ouverture,fermeture:i.data.endroit.heuresOuverture[0].fermeture,ferme:i.data.endroit.heuresOuverture[0].ferme},{jours:i.data.endroit.heuresOuverture[1].jours,ouverture:i.data.endroit.heuresOuverture[1].ouverture,fermeture:i.data.endroit.heuresOuverture[1].fermeture,ferme:i.data.endroit.heuresOuverture[1].ferme}]};console.log("****************************************");o.post("api/endroits/",e,{headers:{Authorization:"Bearer "+a.getToken()}}).then(function(e){console.log("Ajout succes");n.success("Ajout succes","Ajout");console.log(e);t.path("/endroits/"+e.data._id)},function(e){console.log("Erreur");n.error("ErreurErreur","Erreur");console.log(e)})}}})();